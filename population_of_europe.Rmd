---
output:
  html_document: default
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "./outputs"
    )
  })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(sf)
library(rnaturalearth)
library(countrycode)
library(dplyr)
library(ggthemes)

sf_use_s2(FALSE)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
worldmap <- ne_countries(scale = 'medium', type = 'map_units',returnclass = 'sf')
world_pop <- read.csv("./data/pop_data.csv")

uk_df <- filter(worldmap, (name %in% c('England', 'Scotland', 'Wales')))
uk_df$name = 'United Kingdom'

worldmap <- filter(worldmap, ! (name %in% c('England', 'Scotland', 'Wales')))
worldmap <- rbind(worldmap, uk_df)

worldmap$iso3 <- countrycode(worldmap$name, "country.name", "iso3c")

merged_df <- left_join(worldmap, world_pop, by = "iso3")
europe_cropped <- st_crop(merged_df, xmin = -24, xmax = 37,
                                    ymin = 34, ymax = 68)

non_europe <- filter(europe_cropped, (iso3 %in% c("MAR", "DZA", "TUN", "SYR", "LBN", "ISR", "PSE")) )
europe_cropped <- filter(europe_cropped, ! (iso3 %in% non_europe$iso3))

non_europe$pop_2022 = NA
europe_cropped <- rbind(europe_cropped, non_europe)


ggplot(data=europe_cropped) +
  geom_sf(aes(fill=pop_2022)) + 
  scale_fill_continuous(name="Population(millions)", 
            low = "gray90", high = "gray15", 
            breaks=c(5,10,15,20,25,30,35), na.value = "white") +
  theme_map()+
  scale_fill_gradient(low='gray90', high='gray15', na.value = "white", space='Lab')
```
