---
output:
  html_document: default
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "./outputs"
    )
  })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(ggplot2)  
library(maps)
library(dplyr)
library(countrycode)
library(ggplot2)
library(ggthemes)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
world_map_data <- map_data("world")
world_pop <- read.csv("./data/pop_data.csv")

world_map_data$iso3 <- countrycode(world_map_data$region, "country.name", "iso3c")

merged_df <- left_join(world_map_data, world_pop, by = "iso3")

merged_df <- filter(merged_df, (long < 35) & (long > -16))
merged_df <- filter(merged_df, (lat < 66) & (lat > 35))
merged_df <- filter(merged_df, ! (iso3 %in% c("MAR", "DZA", "TUN")) )

merged_df <- merged_df %>% arrange(desc(pop_2022))

df <- head(distinct(merged_df[, c("Country", "pop_2022")], Country, pop_2022 ), n=10) 
df <- df %>% 
  rename(Population = pop_2022)
df <- df %>%
  mutate(across(Population, ~ format(., big.mark = ",", scientific = F)))

df

ggplot() +
  geom_polygon( data=merged_df, 
          aes(x=long, y=lat, group=group, fill = pop_2022), 
          color="white", linewidth = 0.2) + 
  scale_fill_continuous(name="Population(millions)", 
            low = "gray80", high = "gray30", 
            breaks=c(5,10,15,20,25,30,35), na.value = "white") +theme_map()

```
